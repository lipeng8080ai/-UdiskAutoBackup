# U盘自动备份应用（支持自定义备份路径）

这是一个完全离线、后台隐藏运行的安卓应用，用于自动将插入的U盘内容复制到**用户指定的文件夹**。

## 🆕 新功能：自定义备份路径

- ✅ **手动选择备份路径**：通过设置界面指定任意文件夹
- ✅ **路径记忆**：设置一次，永久保存
- ✅ **默认路径**：`/storage/emulated/0/UdiskBackup`

## 功能特点

- ✅ **完全离线**：不依赖网络，不上传任何数据
- ✅ **后台隐藏**：无界面显示，静默运行
- ✅ **自动触发**：检测到U盘插入自动开始复制
- ✅ **开机自启**：设备重启后自动恢复监控
- ✅ **低功耗**：使用前台服务确保后台持续运行

## 如何设置备份路径

### 方法1：通过设置界面（推荐）
1. **安装应用后**，在应用列表中找到 "U盘自动备份设置"
2. **打开设置界面**
3. **修改备份路径**（例如：`/storage/emulated/0/MyBackup`）
4. **点击"保存设置"**

### 方法2：直接编辑配置文件
备份路径存储在：`/data/data/com.example.udiskautobackup/shared_prefs/UdiskAutoBackupPrefs.xml`

## 备份位置

默认备份文件存储在：
```
/storage/emulated/0/UdiskBackup/
```

你可以通过设置界面修改为任意位置，例如：
- `/storage/emulated/0/Documents/UdiskBackup/`
- `/storage/XXXX-XXXX/UdiskBackup/` （SD卡）
- 任何你有写入权限的文件夹

## 使用说明

### 1. 编译安装
```bash
# 克隆项目
git clone [项目地址]

# 使用Android Studio打开项目并编译
# 或使用命令行构建
./gradlew assembleDebug
```

### 2. 首次运行设置
- 安装APK后首次启动会请求必要权限
- 需要授予存储权限（建议授予所有文件访问权限）
- 需要允许忽略电池优化（防止被系统杀死）

### 3. 设置备份路径
- 在应用列表中找到 "U盘自动备份设置"
- 修改为你想要的备份路径
- 保存设置

### 4. 测试功能
- 插入U盘到平板的USB接口
- 应用会自动检测并开始复制
- 文件会保存到你指定的备份文件夹

## 系统兼容性

- **最低支持**：Android 5.0 (API 21)
- **最佳体验**：Android 8.0+ (支持前台服务)
- **存储权限**：适配Android 10+ Scoped Storage
- **特殊权限**：Android 11+ 建议授予"所有文件访问权限"

## 注意事项

1. **USB OTG支持**：确保设备支持USB OTG功能
2. **电池优化**：必须关闭电池优化，否则服务会被系统杀死
3. **存储空间**：确保目标路径有足够空间存储备份文件
4. **U盘格式**：支持FAT32、exFAT、NTFS格式的U盘
5. **权限问题**：如果备份到SD卡，确保有写入权限

## 技术实现

- 使用BroadcastReceiver监听USB设备连接事件
- 前台服务确保后台持续运行
- 文件通道(FileChannel)高效复制大文件
- SharedPreferences保存用户设置
- 开机广播接收器确保服务自动重启

## 许可证

MIT License - 完全开源，可自由修改和分发